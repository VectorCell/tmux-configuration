#!/bin/bash

# this script is tailored specifically to my installation of elementary OS Luna on a Lenovo Yoga 13
# this really needs to be reworked if used on another machine (probably)

if [ "$HOSTNAME" == "Yogix" ]; then
	echo -n " "
	current_charge=$(cat /proc/acpi/battery/BAT1/state | grep 'remaining capacity' | awk '{print $3}')
	total_charge=$(cat /proc/acpi/battery/BAT1/info | grep 'last full capacity' | awk '{print $4}')
	percent=$(python -c  "print (100 * $current_charge) / $total_charge" | tr -d '\n')
	if [ $percent == 100 ]; then
		echo -n "charged "
	else
		echo -n "$percent% "
		if [ "$(cat /proc/acpi/battery/BAT1/state | grep charging | awk '{print $3}')" == "charging" ]; then
			echo -n "↑ "
			acpi -b | awk '{print $5}' | tr ':' ' ' | awk '{print $1,$2}' | tr ' ' ':' | tr -d '\n'
			echo -n " "
		else
			if [ "$(cat /proc/acpi/battery/BAT1/state | grep charging | awk '{print $3}')" == "discharging" ]; then
				echo -n "↓ "
				acpi -b | awk '{print $5}' | tr ':' ' ' | awk '{print $1,$2}' | tr ' ' ':' | tr -d '\n'
				echo -n " "
				python -c "print str(round($(cat /proc/acpi/battery/BAT1/state | grep 'present rate' | awk '{print $3}') / 1000.0, 1)) + 'W '"
			else
				echo -n "charged "
			fi
		fi
	fi

	# low battery warning
	if [ $percent -lt 20 ]; then
		echo -n "#[fg=black,bg=colour48] LOW BATTERY #[fg=white,bg=colour235] "
	elif [ $percent -lt 6 ]; then
		echo -n "#[fg=white,bg=red] CRITIAL BATTERY #[fg=white,bg=colour235] "
	fi

else
	echo ""
fi

